--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -170,7 +170,7 @@ macro_optional_add_subdirectory( doc )
    endif(NOT WIN32)
 
    if(X11_Xau_FOUND AND X11_Xdmcp_FOUND)
-      add_subdirectory( kdm )
+      macro_optional_add_subdirectory( kdm )
    else(X11_Xau_FOUND AND X11_Xdmcp_FOUND)
       message(STATUS "Xau lib or Xdmcp lib was missing. kdm will not compile")
    endif(X11_Xau_FOUND AND X11_Xdmcp_FOUND)
--- a/libs/CMakeLists.txt
+++ b/libs/CMakeLists.txt
@@ -5,7 +5,9 @@
 add_subdirectory(solid)

 if(${KDE_PLATFORM_PROFILE} STREQUAL "Desktop")
+   if(BUILD_kdm)
    add_subdirectory(kdm)
+   endif(BUILD_kdm)
    add_subdirectory(plasmagenericshell)
    if(NOT WIN32)
         add_subdirectory(taskmanager)
